- hosts: localhost
  tasks:
    - name: Read source bucket csv
      read_csv:
        path: /home/Solomon/Code/CM/source_bucket.csv
        fieldnames: Bucket,Key,Size,LastModifiedDate,ETag
      register: source_bucket
    
    - name: Read dest bucket csv
      read_csv:
        path: /home/Solomon/Code/CM/dest_bucket.csv
        fieldnames: Bucket,Key,Size,LastModifiedDate,ETag
      register: dest_bucket
        
    - name: Get difference of the two lists
      set_fact: 
        difference: '{{ source_bucket.list | difference (dest_bucket.list) }}'
    
    - name: Template out new csv file
      template:
        dest: differnce_csv.csv
        src: template_csv.j2

    - debug:
        var: difference