- hosts: localhost
  vars:
    number1: 1_000
    number2: 1000
  tasks:
    - debug:
        msg: '{{ number1 + number2 }}'

    - pause:
    - name: Read source bucket csv
      read_csv:
        path: /home/Solomon/Code/CM/source_bucket.csv
        fieldnames: Bucket,Key,Size,LastModifiedDate,ETag
        key: Key
      register: source_bucket
    
    - name: Read dest bucket csv
      read_csv:
        path: /home/Solomon/Code/CM/dest_bucket.csv
        fieldnames: Bucket,Key,Size,LastModifiedDate,ETag
        key: Key
      register: dest_bucket
    
    - debug:
        var: (source_bucket.dict | dict2items | first).value.Bucket

    - debug:
        var: item
      loop: '{{source_bucket.dict | dict2items | first }}'
    
    

    #- fail:

    - name: Get difference of the two lists
      set_fact: 
        difference: '"key": {{ source_bucket.dict | difference (dest_bucket.dict) }}'
    
    - name: Get union of difference and OG source
      set_fact:
        union: '{{ union | d([]) + source_bucket.dict | dict2items | union(difference) }}'
    
    #- name: Template out new csv file
    #  template:
    #    dest: differnce_csv.csv
    #    src: template_csv.j2

    - debug:
        var: union