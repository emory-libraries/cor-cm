# s3-batch-op
s3_batch_op: '{{ curate_arch_tagging_op }}'

default_s3_batch_op_region: us-west-1
default_s3_batch_op_account_id: '{{ aws_account_number }}'
default_s3_batch_op_role_arn: 'arn:aws:iam::{{ aws_account_number }}:role/s3-batch-job-role'

s3_batch_op_submit_only: false
s3_batch_op_generate_direct_download: true
s3_batch_op_generate_console_download: true

s3_batch_op_slack_token: '{{ vault_dlp.slack.token }}'
s3_batch_op_slack_channel: '#dlp-backups'
s3_batch_op_slack_attachments: 
  - title: S3 Batch Operation Job Summary
    text: |
      How does slack handle,
      Newlines?
       {{ (optional_variable != "none") | ternary (optional_variable, "") }}
      {{ required_variable }}

curate_arch_tagging_op:
  operation:
    S3PutObjectTagging:
      TagSet:
      - Key: Another
        Value: Test
  manifest:
    Spec:
      Format: S3InventoryReport_CSV_20161130
  report:
    Bucket: arn:aws:s3:::cor-s3-inventory-1
    Prefix: fedora-cor-arch-binaries/completion-report
    Format: Report_CSV_20180820
    Enabled: true
    ReportScope: AllTasks
  priority: 23
  location:
    Date: '2020-03-25'
    KeyPrefix: cor-s3-inventory-2/fedora-cor-arch-binaries/manifest/

fedora_arch_to_dlp_test_copy:
- operation:
    S3PutObjectCopy:
      TargetResource: arn:aws:s3:::temp-bucket-dlp-test
      NewObjectTagging:
      - Key: ObjectFromFedoraArch
        Value: DeletePlz
  manifest:
    Spec:
      Format: S3InventoryReport_CSV_20161130
    Location:
      ObjectArn: arn:aws:s3:::cor-s3-inventory-2/fedora-cor-arch-binaries/manifest/2019-11-17T00-00Z/manifest.json
      ETag: 23dfb69aa65bfcc7378ced950f031b0d      
  report:
    Bucket: arn:aws:s3:::cor-s3-inventory-2
    Prefix: fedora-cor-arch-binaries/completion-report
    Format: Report_CSV_20180820
    Enabled: true
    ReportScope: AllTasks
  priority: 23

fedora_test_to_backup_test_copy:
- operation:
    S3PutObjectCopy:
      TargetResource: arn:aws:s3:::backup-fedora-cor-test-binaries
  manifest:
    Spec:
      Format: S3InventoryReport_CSV_20161130
    Location:
      Date:
        Key: cor-s3-inventory-2/fedora-cor-test-binaries/manifest/
        #Latest: yes
        Year: '2020'
        Month: '01'
        Day: '19'
      #ObjectArn: arn:aws:s3:::cor-devops-binaries/fedora-cor-test-binaries/manifest/2020-02-06T00-00Z/manifest.json
      #ETag: 44dea86208c0c71df234d97b2c114e7e      
  report:
    Bucket: arn:aws:s3:::cor-s3-inventory-2
    Prefix: fedora-cor-test-binaries/completion-report
    Format: Report_CSV_20180820
    Enabled: true
    ReportScope: AllTasks
  priority: 23
  region: us-west-2
- operation:
    S3PutObjectCopy:
      TargetResource: arn:aws:s3:::temp-bucket-dlp-test
      NewObjectTagging:
      - Key: ObjectFromFedoraArch
        Value: DeletePlz
  manifest:
    Spec:
      Format: S3InventoryReport_CSV_20161130
    Location:
      ObjectArn: arn:aws:s3:::cor-s3-inventory-2/fedora-cor-arch-binaries/manifest/2019-11-17T00-00Z/manifest.json
      ETag: 23dfb69aa65bfcc7378ced950f031b0d      
  report:
    Bucket: arn:aws:s3:::cor-s3-inventory-2
    Prefix: fedora-cor-arch-binaries/completion-report
    Format: Report_CSV_20180820
    Enabled: true
    ReportScope: AllTasks
  priority: 23


 
curate_test_put_copy_op:
  - region: us-east-1
    operation:
      S3PutObjectCopy:
        TargetResource: arn:aws:s3:::fedora-cor-arch-binaries
    report:
      Bucket: arn:aws:s3:::cor-s3-inventory-2
      Prefix: fedora-cor-arch-binaries/completion-report
      Format: Report_CSV_20180820
      Enabled: true
      ReportScope: AllTasks
    priority: 23
    description: Test Copy Operation in Ansible

curate_test_acl_op:
  - operation:
      S3PutObjectAcl:
        AccessControlPolicy:
          AccessControlList:
            Owner:
              Id:
              DisplayName:
            Grants:
              - Grantee:
                  TypeIdentifier:
                  Identifier:
                  DisplayName:
                Permission:
          CannedAccessControlList: