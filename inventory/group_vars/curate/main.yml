project_name: "{{ git_repo_url | urlsplit('path') | basename }}"
git_repo_url: "https://github.com/emory-libraries/dlp-curate"
enable_ssl: "yes"
ec2_instance_type: t3.large
git_repo_branch: v0.3.8

seed_hyrax_db: yes
idp_name: "prod"
ssh_pub_keys:
  - https://github.com/devanshu-m.keys
  - https://github.com/mprefer.keys
  - https://github.com/alexBLR.keys
  - https://github.com/rotated8.keys
  - https://github.com/laurenhamel.keys
  - https://github.com/SolomonHD.keys
  - https://github.com/bess.keys
  - https://github.com/little9.keys
  - https://github.com/mark-dce.keys
  - https://github.com/wulman16.keys

symblink_dirs:
#  - src: "/mnt/efs/{{ project_name }}" Removed due to poor performance
#    path: "{{ capistrano_base }}/{{ project_name }}"
  - src: "/mnt/efs/uploads"
    path: "{{ capistrano_base }}/uploads"
dlp_curate_linked_files:
  - content: "{{ lookup('file', 'resources/admins.yml') }}"
    dest: "{{ capistrano_base }}/{{ project_name }}/shared/config/emory/groups/admins.yml"
    mode: 0644
  - content: "{{ lookup('file', 'resources/health_sciences_manager.yml') }}"
    dest: "{{ capistrano_base }}/{{ project_name }}/shared/config/emory/groups/health_sciences_manager.yml"
    mode: 0644
  - content: "{{ lookup('file', 'resources/health_sciences_depositor.yml') }}"
    dest: "{{ capistrano_base }}/{{ project_name }}/shared/config/emory/groups/health_sciences_depositor.yml"
    mode: 0644
  - content: "{{ lookup('file', 'resources/health_sciences_viewer.yml') }}"
    dest: "{{ capistrano_base }}/{{ project_name }}/shared/config/emory/groups/health_sciences_viewer.yml"
    mode: 0644
  - content: "{{ lookup('file', 'resources/oxford_manager.yml') }}"
    dest: "{{ capistrano_base }}/{{ project_name }}/shared/config/emory/groups/oxford_manager.yml"
    mode: 0644
  - content: "{{ lookup('file', 'resources/oxford_depositor.yml') }}"
    dest: "{{ capistrano_base }}/{{ project_name }}/shared/config/emory/groups/oxford_depositor.yml"
    mode: 0644
  - content: "{{ lookup('file', 'resources/oxford_viewer.yml') }}"
    dest: "{{ capistrano_base }}/{{ project_name }}/shared/config/emory/groups/oxford_viewer.yml"
    mode: 0644
  - content: "{{ lookup('file', 'resources/repository_manager.yml') }}"
    dest: "{{ capistrano_base }}/{{ project_name }}/shared/config/emory/groups/repository_manager.yml"
    mode: 0644
  - content: "{{ lookup('file', 'resources/rose_manager.yml') }}"
    dest: "{{ capistrano_base }}/{{ project_name }}/shared/config/emory/groups/rose_manager.yml"
    mode: 0644
  - content: "{{ lookup('file', 'resources/rose_depositor.yml') }}"
    dest: "{{ capistrano_base }}/{{ project_name }}/shared/config/emory/groups/rose_depositor.yml"
    mode: 0644
  - content: "{{ lookup('file', 'resources/rose_viewer.yml') }}"
    dest: "{{ capistrano_base }}/{{ project_name }}/shared/config/emory/groups/rose_viewer.yml"
    mode: 0644
  - content: "{{ lookup('template', 'dotenv_dict.j2') }}"
    dest: "{{ capistrano_base }}/{{ project_name }}/shared/.env.production"
    mode: 0644

get_metadata:
  download: no

dlp_curate_dotenv:
  admin_password: "{{ vault_dlp.project.default_admin_password | d ('') }}"
  contact_us_email: "test@emory.edu"
  cache_path: "/opt/uploads/dlp-curate/cache/"
  upload_path: "/opt/uploads/dlp-curate/"
  working_path: "/opt/uploads/dlp-curate/"
  derivatives_path: "/opt/uploads/dlp-curate/derivatives/"
  database_auth: false
  database_adapter: "mysql2"
  database_pool: 5
  database_name: "{{ dlp_curate_mysql_db.name | d ('') }}"
  database_username: "{{ dlp_curate_mysql_db.user | d ('') }}"
  database_host: "{{ rds_endpoint | d ('') }}"
  database_password: "{{ dlp_curate_mysql_db.password | d ('') }}"
  geonames_username: "{{ vault_geonames_username  | d ('') }}"
  import_path: "{{ __dlp_curate_dotenv.import_path | d ('') }}"
  project_name: "dlp-curate"
  sidekiq_workers: 5
  fedora_url: "{{ __dlp_curate_dotenv.fedora_url | d ('') }}" 
  fedora_user: "{{ vault_fedora.admin.user | d ('') }}"
  fedora_password: "{{ vault_fedora.admin.pass | d ('') }}"
  solr_url: "{{ __dlp_curate_dotenv.solr_url | d ('') }}" 
  redis_host: localhost
  redis_port: 6379

mysql_dbs:
  - id: curate
    db_name: "{{ dlp_curate_mysql_db.name | d ('') }}"
    login_user: "{{ dlp_curate_mysql_db.user | d ('') }}"
    login_host: "{{ hostvars[rds_host]['endpoint']['address'] | d ('') }}" 
    login_password: "{{ dlp_curate_mysql_db.password | d ('') }}"
    mysqldump:
      s3_bucket: cor-devops-binaries
      s3_bucket_path: "/mysqldumps/{{ inventory_hostname_short }}"
      service:
        name: httpd

