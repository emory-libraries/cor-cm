---
- name: Set userdata for EC2 (No EFS)
  set_fact:
    ec2_user_data: "{{ lookup('template', 'user_data.j2') }}"
  when: not efs_mounts | d (False)

- name: Set userdata for EC2 (EFS)
  set_fact:
    ec2_user_data: "{{ lookup('template', 'user_data_efs_mnt.j2') }}"
  when: efs_mounts | d (False)

- name: Set ec2 state to start stopped instance
  set_fact:
    ec2_state: started
  when: state is defined and state.name == "stopped"
