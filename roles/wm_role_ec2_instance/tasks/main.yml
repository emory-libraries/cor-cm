---
# tasks file for wm_role_ec2_instance

- include_tasks:
    file: set-user-data.yml
    apply:
      tags:
        - create-ec2
  tags:
    - create-ec2

- include_tasks:
    file: create-or-terminate-ec2.yml
    apply:
      tags:
        - create-ec2
  tags:
    - create-ec2

- name: Delete ec2 instance
  include_tasks:
    file: create-or-terminate-ec2.yml
  vars:
    ec2_state: absent
  tags:
    - delete-ec2
    - never

- include_tasks:
    file: terminate-ec2-instances-found.yml
    apply:
      tags:
        - delete-ec2
        - never
  tags:
    - delete-ec2
    - never
  when: ec2.changed

- include_tasks:
    file: terminate-ec2-none-found.yml
    apply:
      tags:
        - delete-ec2
        - never
  tags:
    - delete-ec2
    - never
  when: not ec2.changed
