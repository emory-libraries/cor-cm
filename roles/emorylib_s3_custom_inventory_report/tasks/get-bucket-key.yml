---
- name: List keys for {{ bucket_type }} bucket, via awscli
  shell: aws s3 ls {{ s3.bucket }}/{{ s3.key_prefix | d () | regex_replace(get_trailing_slash, '') }} | sed 's/PRE //g' | sed 's/.$//g' | grep -Ev "data|hive"
  vars:
    get_trailing_slash: \/$
  register: bucket_key_info

- debug:
    var: bucket_key_info

- name: Create key list for {{ bucket_type }} keys.
  set_fact:
    '{{ bucket_type }}_bucket_keys': '{{ bucket_key_info.stdout_lines | map("trim") | list }}'

- debug:
    var: source_bucket_keys