---
# defaults file for emorylib_role_s3_batch_operations

s3_batch_op_submit_only: true
s3_batch_op_generate_direct_download: false
s3_batch_op_generate_console_download: false

### Slack options
s3_batch_op_report_to_slack: false
s3_batch_op_slack_token: slack/token/goes/here
#s3_batch_op_slack_attachments:
#s3_batch_op_slack_icon_emoji: 
#s3_batch_op_slack_msg:
#s3_batch_op_slack_token: 
#s3_batch_op_slack_channel: '#channel'
#s3_batch_op_slack_username: 
#s3_batch_op_slack_thread_id: 
#s3_batch_op_slack_link_names: 
#s3_batch_op_slack_icon_url: 
#s3_batch_op_slack_parse: 


s3_batch_op_describe_job_retries: 50
s3_batch_op_describe_job_delay: 20


s3_batch_op_console_base_url: https://s3.console.aws.amazon.com/s3/object



s3_batch_op_slack_msg: '{{ ansible_facts.env.AWX_HOST is defined | ternary (s3_batch_op_slack_msg_awx, s3_batch_op_slack_msg_no_awx) }}'

s3_batch_op_slack_msg_no_awx: |
  S3 Batch Operations Job Supplementary Details
  {{ s3_batch_op_job["ProgressSummary"] | to_nice_yaml(indent=8, width=1337) }}
s3_batch_op_slack_msg_awx: |
  Job {{ ansible_facts.env.JOB_ID | d () }} Supplementary Details
  {{ s3_batch_op_job["ProgressSummary"] | to_nice_yaml(indent=8, width=1337) }}

s3_batch_op_slack_attachments: '{{ s3_batch_op_slack_attachment_console + s3_batch_op_slack_attachment_direct }}'

s3_batch_op_slack_attachment_console: '{{ report_console_download_link is defined | ternary (s3_batch_op_slack_attachment_console_content, []) }}'
s3_batch_op_slack_attachment_direct: '{{ report_direct_download_link is defined | ternary (s3_batch_op_slack_attachment_direct_content, []) }}'

s3_batch_op_slack_attachment_console_content:
  - title: Batch Operation Report Console Link
    title_link: '{{ report_console_download_link }}'
    text: This is a console link to the report, please log into AWS console before using the link
s3_batch_op_slack_attachment_direct_content:
  - title: Batch Operation Report Direct Link
    title_link: '{{ report_direct_download_link }}'
    text: This is a direct link to the report, links in private buckets are valid for 10 minutes