---
- include_tasks: add-repo-install-shibb.yml

- include_tasks: download-files-metadata.yml

- include_tasks: setup-ssl-files.yml
  when: sp_ssl_files is defined

- include_tasks: check-if-passenger-enabled.yml

- include_tasks: enable-start-shibb.yml

- include_tasks: 
    file: metadata-download.yml
    apply: 
      tags: metadata-download
  tags: metadata-download
  when: metadata_download.download 

- include_tasks:
    file: add-additional-endpoints-to-metadata.yml
    apply:
      tags: add-endpoints
      delegate_to: localhost
  tags: add-endpoints
  when: 
    - metadata_download_result | d(False) is success
    - additional_assertion_bindings | d(False)

- include_tasks:
    file: delete-shibboleth.yml
    apply:
      tags:
        - delete-shibb
        - never
  tags:
    - delete-shibb
    - never
